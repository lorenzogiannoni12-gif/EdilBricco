<!DOCTYPE html>
<html>
<head>
<title>EDIL BRICCO NETWORK</title>

<style>
body {
  background: radial-gradient(circle at top, #1a1a1a, #000);
  font-family: Arial, sans-serif;
  text-align: center;
  padding-top: 60px;
  color: white;
}

body::before {
  content:"";
  position: fixed;
  top:-200px;
  left:50%;
  width:1200px;
  height:600px;
  background: radial-gradient(circle, rgba(255,200,80,0.15), transparent 70%);
  transform: translateX(-50%);
}

.card {
  background: rgba(20,20,20,0.95);
  width: 460px;
  margin: auto;
  padding: 30px;
  border-radius: 14px;
  box-shadow: 0 0 25px rgba(255,150,50,0.25), 0 10px 40px rgba(0,0,0,0.8);
  border: 1px solid rgba(255,140,0,0.2);
}

.logo {
  width:330px;
  margin-bottom:10px;
  filter:
    drop-shadow(0 0 8px rgba(255,140,0,0.6))
    drop-shadow(0 0 35px rgba(255,140,0,0.4));
}

h2 { color:#ffae42; }
p { color:#ccc; font-size:14px; }

button {
  padding: 15px;
  margin: 8px;
  font-size: 15px;
  width: 100%;
  border-radius: 8px;
  border: none;
  cursor: pointer;
}

input {
  width:100%;
  padding:10px;
  margin:5px 0;
  border-radius:6px;
  border:none;
}

.accept { background:#ff7b00; color:black; font-weight:bold; }
.sub { background:#333; color:white; }
.abuse { background:black; color:#ff3333; border:1px solid #ff3333; }

.small {
  font-size:12px;
  color:#aaa;
  margin-top:18px;
  text-transform:uppercase;
  letter-spacing:2px;
}

.progress {
  width:100%;
  background:#222;
  border-radius:6px;
  overflow:hidden;
  margin-top:10px;
}

.bar {
  height:10px;
  width:0%;
  background:#ff7b00;
  transition:0.3s;
}

.footer {
  font-size:10px;
  margin-top:20px;
  color:#666;
  font-style:italic;
}
#orgBtn{
 width:40%;
 padding:10px;
 margin:1px 0 8px auto;
 background:#222;
 color:white;
 border-radius:8px;
 border:1px solid #555;
 font-size:12px;
 cursor:pointer;

 transform: translateX(-35px);
}
#sidebtn{
 width:40%;
 padding:10px;
 margin:1px 0 8px auto;
 background:#111;
 color:#aaa;
 border-radius:8px;
 border:1px solid #444;
 font-size:12px;
 cursor:pointer;
 pointer-events:none;
opacity:0.8;
cursor:default;

 transform: translateX(40px);
}
#orgList{
 max-height:300px;
 overflow-y:auto;
 margin-top:10px;
 text-align:left;
}

.footer p { margin:2px 0; font-size:10px; }
</style>
</head>

<body>

<div class="card">

<img src="logo.png" class="logo">
<h2>EDIL BRICCO SRL - AREA DIPENDENTI</h2>

<!-- SPLASH -->
<div id="splash">
<p>Accesso riservato a personale e subappaltatori autorizzati.</p>

<button class="accept" onclick="showRegister()">üß± REGISTRAZIONE</button>

<div class="small">Opzioni aggiuntive</div>

<button class="sub" onclick="startFlow('sub')">üì¶ SUBAPPALTO</button>
<button class="abuse" onclick="startFlow('abuse')">üö® ABUSO</button>
<div class="orgRow">

  <button id="orgBtn" onclick="openOrg()">üìã <br>
  ORGANIGRAMMA
  </button>

  <button id="sidebtn">
 üë• DIPENDENTI<br>
 <strong id="userCount">0</strong>
</button>

</div>
<div class="small">Servizi aggiuntivi</div>
<div class="footer">
<p>Dove siamo?</p>
<p>Chi ha preso la mia cazzuola?</p>
<p>Lavora con noi</p>
</div>
</div>

<!-- REGISTRAZIONE -->
<div id="register" style="display:none;">
<p><b>Registrazione dipendente</b></p>

<input id="name" placeholder="Nome">
<input id="surname" placeholder="Cognome">

<button class="accept" onclick="startEmployee()">Continua</button>
</div>

<!-- QUIZ -->
<div id="quiz" style="display:none;">
<p id="quizTitle"></p>
<p id="quizQuestion"></p>
<div id="answers"></div>

<div class="progress">
<div class="bar" id="bar"></div>
</div>
<p id="progressText"></p>

</div>

<!-- BADGE -->
<div id="badge" style="display:none;">
<h3>ü™™ BADGE DIGITALE</h3>
<p id="badgeRole"></p>
<p id="badgeLevel"></p>
<p id="badgeId"></p>
<button class="accept" onclick="repeatQuiz()">üîÅ Ripeti quiz</button>
<button class="sub" onclick="goHome()">‚¨Ö Torna al menu</button>
<button class="abuse" onclick="buyTrowel()">üõí Compra una cazzuola</button>

</div>
<div id="orgPanel" style="display:none;">
<h3>üìã ORGANIGRAMMA AZIENDALE</h3>
<div id="orgList"></div>
<!-- LINK FOGLIO -->
<!--<iframe
 src="https://docs.google.com/spreadsheets/d/e/2PACX-1vR1beDvsUY4OP-I8slMpdyqu2oCp6BYV2EGGZaTHl0cx1fzseZVAoflUM-98ruMMnjl8cv8JicnieH2/pubhtml"
 style="width:100%;height:300px;border:none;background:white;">
</iframe>-->

<button class="sub" onclick="closeOrg()">‚¨Ö Torna</button>
</div>

</div>

<script>

let errors=0,step=0,flow=null;
let userName="", userSurname="";
const employeeRoles = [
 "Capo Betoniera Senior",
 "Responsabile Cazzuola Strategica",
 "Direttore Operativo Mattoni",
 "Commerciale SalseManager",
 "Problem Solver",
 "Supervisore Ponteggi & Aperitivi",
 "Project Manager Intonaco",
 "Tecnico Certificato Tromba Laser",
 "Responsabile Pallette",
 "Addetto Collaudo Detox",
 "Capo Reparto Secchi & Palette",
 "Analista Strutturale da Bar",
 "Vice Geometra Ombra",
 "Esperto Biscette Creative",
 "Auditor Ufficiale DPI"
];

const flows={
employee:{
 role:"DIPENDENTE",
 level:1,

 pool:[
  {q:"Quanti mattoni servono per un muro serio?",a:["2","10","Dipende dal geometra"],c:2},
  {q:"Chi comanda in cantiere?",a:["Il cliente","Il muratore","Il geometra"],c:2},
  {q:"Cosa va portato al geometra?",a:["Solo cemento","Le 3 C","Una cazzuola"],c:1},
  {q:"Quando finisce il lavoro?",a:["Alle 17","Quando lo dice il geometra","Mai"],c:1},
  {q:"Cos'√® un cappotto termico?",a:["Un muratore freddo","Isolamento","Un giubbotto"],c:2},
  {q:"Chi firma il collaudo?",a:["Il tecnico","Il cliente","Il geometra"],c:2},
  {q:"Cosa manca sempre in cantiere?",a:["Tempo","Caff√®","Tutto"],c:2},
  {q:"Chi porta i DPI?",a:["Nessuno","Il geometra","Il lavoratore"],c:2},
  {q:"Cos'√® il PSC?",a:["Un documento","Una scusa","Un mattone"],c:2},
  {q:"Che giorno si consegna?",a:["Oggi","Domani","Mai certo"],c:2}
 ],

 count:10
},
 sub:{
  role:"SUBAPPALTATORE",
  level:2,
  questions:[
   {q:"Cosa deve avere il geometra?",a:["Solo cemento","Le 3 C","Una cazzuola"],c:1},
   {q:"Chi comanda in cantiere?",a:["Il muratore","Il cliente","Il geometra"],c:2},
   {q:"Quando finisce il lavoro?",a:["L'orario √® flessibile","Alle 17","Quando lo dice il geometra"],c:2}
  ]
 },
 abuse:{
  role:"VISITATORE",
  level:0,
  questions:[
   {q:"Perch√© sei qui?",a:["Wi-Fi gratis","Lavori in nero","Corso di formazione"],c:1},
   {q:"Quanti mattoni hai?",a:["Cos‚Äô√® un mattone?","100","S√¨"],c:2},
   {q:"Hai un documento?",a:["Carta","Patente","Mattone"],c:2},
   {q:"Chi ti manda?",a:["Nessuno","Il Geometra","La finanza"],c:1},
   {q:"Accetti responsabilit√†?",a:["No","Forse","S√¨"],c:1}
  ]
 }
};

function showRegister(){
 document.getElementById("splash").style.display="none";
 document.getElementById("register").style.display="block";
}

function startEmployee(){
 userName=document.getElementById("name").value.trim();
 userSurname=document.getElementById("surname").value.trim();

 if(!userName || !userSurname){
  alert("Inserire nome e cognome.");
  return;
 }

 document.getElementById("register").style.display="none";
 startFlow('employee');
}

function startFlow(f){
 flow=f;
 step=0;
 errors=0;
 
 if(f !== "employee"){
 userName="";
 userSurname="";
}

 // Se √® employee, genera le domande dal pool
 if(flow === "employee"){
   flows.employee.questions =
     [...flows.employee.pool]
       .sort(() => 0.5 - Math.random())
       .slice(0, flows.employee.count);
 }

 document.getElementById("splash").style.display="none";
 document.getElementById("quiz").style.display="block";

 loadQuestion();
}

function loadQuestion(){
 const q=flows[flow].questions[step];
 document.getElementById("quizTitle").innerHTML="<b>Verifica "+flows[flow].role+"</b>";
 document.getElementById("quizQuestion").innerText=q.q;

 let h="";
 q.a.forEach((x,i)=>{
  h+=`<button onclick="${i==q.c?"correct()":"wrong()"}">${x}</button>`;
 });
 document.getElementById("answers").innerHTML=h;

 let pct=Math.floor((step/flows[flow].questions.length)*100);
 document.getElementById("bar").style.width=pct+"%";
 document.getElementById("progressText").innerText="Verifica geometra... "+pct+"%";
}

function wrong(){
 errors++;
 alert("Risposta errata. Porta un mattone.");
 if(errors>=3){
  alert("Hai commesso 3 errori, riparti da capo e porta 3 mattoni. Coglione!.");
  startFlow(flow);
 }
}

function correct(){
 step++;
 if(step>=flows[flow].questions.length){
  finish();
 } else loadQuestion();
}

function finish(){
 document.getElementById("quiz").style.display="none";
 document.getElementById("badge").style.display="block";
 document.getElementById("bar").style.width="100%";

 let id="BRK-"+Math.floor(Math.random()*9000+1000);

 let roleText = flows[flow].role;

 // SOLO per registrazione assegna ruolo casuale
 if(flow === "employee"){
   roleText = employeeRoles[Math.floor(Math.random()*employeeRoles.length)];
 }

 document.getElementById("badgeRole").innerText =
 userName+" "+userSurname+" ‚Äì "+roleText;

 document.getElementById("badgeLevel").innerText =
 "LIVELLO: "+flows[flow].level;

 document.getElementById("badgeId").innerText = "ID: "+id;
 
 fetch("https://docs.google.com/forms/d/e/1FAIpQLSc-1ZCV9KhWUdoVptTdZuJpNLz_cqpEH14MlXo3QVpa0ZkbEg/formResponse",{   //link forms
 method:"POST",
 mode:"no-cors",
 headers:{
  "Content-Type":"application/x-www-form-urlencoded"
 },
body:
  "entry.1766632263=" + encodeURIComponent(userName) +
  "&entry.1551268425=" + encodeURIComponent(userSurname) +
  "&entry.586627416=" + encodeURIComponent(roleText) +
  "&entry.1361897742=" + encodeURIComponent(id) +
  "&submit=Submit"
});

}

function goHome(){
 flow=null;
 step=0;
 errors=0;

 document.getElementById("quiz").style.display="none";
 document.getElementById("badge").style.display="none";
 document.getElementById("register").style.display="none";

 document.getElementById("name").value="";
 document.getElementById("surname").value="";

 document.getElementById("splash").style.display="block";
 document.getElementById("bar").style.width="0%";
}

function repeatQuiz(){
 if(flow){
   step=0;
   errors=0;

   document.getElementById("badge").style.display="none";
   document.getElementById("quiz").style.display="block";
   document.getElementById("bar").style.width="0%";

   loadQuestion();
 }
}

function buyTrowel(){
 window.open(
  "https://www.amazon.it/Spear-Jackson-cazzuola-10507-blu/dp/B0043YHKLQ/ref=sr_1_4?crid=2UQS6BLT1DO7&dib=eyJ2IjoiMSJ9.ya6dj_tzTsx3OX5fSEyAs48wfh2jWR7hFnJYz9hln5e2DEI4h3Dl62qjIuSmQ68iz1p9Za6E7xU1DZW7-tdcE2eKiXXclm0hxpoEa9Bv3mTkK1hxgdSSwQiELIr_zIonj22I6Dmn7Nc-t9uVa_cPejsDxEgyfMZLh6lGpYkaaq0-mw5dFBBBTlAqrD0WPv7Z8v6PybY1LQYVJrCOKma3PGIPMy91UxpnIM-ph-xMqB2tQvmv9uQ8muamyM2wLg52h0yZf-4dWhrxfey6kH_gXfBWqCzF8rEoGPkpn4nWy78.AVa14idI8gvTUgnhVqnnMzMmDoKtlt-5P-m9FQ8y7Zw&dib_tag=se&keywords=cazzuola+muratore&qid=1771452926&sprefix=cazzu%2Caps%2C249&sr=8-4",
  "_blank"
 );
}
const SHEET_CSV = "https://api.allorigins.win/raw?url=" +
encodeURIComponent("https://docs.google.com/spreadsheets/d/e/2PACX-1vR1beDvsUY4OP-I8slMpdyqu2oCp6BYV2EGGZaTHl0cx1fzseZVAoflUM-98ruMMnjl8cv8JicnieH2/pub?gid=1518823272&single=true&output=csv");    //LINK COUNTER

function openOrg(){

 document.getElementById("splash").style.display="none";
 document.getElementById("quiz").style.display="none";
 document.getElementById("badge").style.display="none";
 document.getElementById("register").style.display="none";
 document.getElementById("orgPanel").style.display="block";

 fetch(SHEET_CSV)
 .then(r=>r.text())
 .then(csv=>{

   let rows = csv.trim().split("\n").slice(1);
   let html="";

   rows.reverse().forEach(row=>{
     let c = row.split(",");

     if(c[0]){
       html+=`<p>${c[1]} ${c[2].charAt(0)}. ‚Äì ${c[3]}</p>`;
     }
   });

   document.getElementById("orgList").innerHTML =
     html || "<p>Nessun dipendente.</p>";

 });

}

function closeOrg(){
 document.getElementById("orgPanel").style.display="none";
 document.getElementById("splash").style.display="block";
}


function loadUserCount(){

 const url =
 "https://docs.google.com/spreadsheets/d/e/2PACX-1vR1beDvsUY4OP-I8slMpdyqu2oCp6BYV2EGGZaTHl0cx1fzseZVAoflUM-98ruMMnjl8cv8JicnieH2/pub?gid=1518823272&single=true&output=csv";

 fetch("https://api.allorigins.win/raw?url="+encodeURIComponent(url))
 .then(r=>r.text())
 .then(csv=>{

   let rows = csv.trim().split("\n");
   let count = rows.length - 1;

   document.getElementById("userCount").innerText = count;

 })
 .catch(e=>{
   document.getElementById("userCount").innerText="‚Äì";
 });

}

loadUserCount();
setInterval(loadUserCount,15000);


</script>

</body>
</html>

